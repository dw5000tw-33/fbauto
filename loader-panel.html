<!doctype html>
<meta charset="utf-8" />
<title>Panel Loader</title>
<style>
  body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC",Arial;margin:24px;color:#111}
  .ok{color:#16a34a}.err{color:#dc2626}
</style>
<body>
<script>
(function(){
  // 允許用 ?u= 自訂面板檔網址；預設抓同 repo 的 panel0-v1.7.js
  const url = new URL(location.href);
  const panelURL = url.searchParams.get('u')
      || 'https://dw5000tw-33.github.io/fb-core-relay/panel0-v1.7.js?ts=' + Date.now();
  const targetOrigin = location.origin; // 父頁檢查 ev.origin 會用到這個網域

  fetch(panelURL, { cache: 'no-store' })
    .then(r => r.text())
    .then(code => {
      // 回傳面板原始碼給父視窗
      if (window.opener && !window.opener.closed) {
        window.opener.postMessage({ type:'PANEL_CODE', code }, targetOrigin);
        document.body.innerHTML =
          '<p class="ok">✅ 面板已送回父頁，可以關閉這個視窗。</p>';
      } else {
        document.body.innerHTML =
          '<p class="err">⚠️ 找不到父視窗，請手動返回 Facebook 頁面。</p>';
      }
    })
    .catch(err => {
      if (window.opener && !window.opener.closed) {
        window.opener.postMessage({ type:'PANEL_ERROR', message: String(err) }, targetOrigin);
      }
      document.body.innerHTML =
        '<p class="err">❌ 載入面板失敗：' + (err && err.message ? err.message : String(err)) + '</p>';
    });
})();
</script>
</body>
